<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IsRayNotArray gh-pages</title>
  <link rel="stylesheet" href="./style.css">
  <style>
    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.3; }
      100% { opacity: 1; }
    }
    .parking-marker {
      background-color: rgba(255, 255, 0, 0.8);
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
      font-size: 14px;
      color: black;
      cursor: pointer;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <header>
    <nav class="nav-buttons">
      <button onclick="scrollToSection('intro-section')">系統簡介</button>
      <button onclick="scrollToSection('search-section')">座位查詢</button>
      <button onclick="scrollToSection('parking-info-section')">停車場資訊</button>
    </nav>
  </header>

  <main>
    <section class="intro-section">
      <div class="intro-container">
        <h2>系統簡介</h2>
        <div class="intro-content">
          <p>歡迎使用座標查詢系統</p>
          <p>本系統提供以下功能：</p>
          <ul>
            <li>快速座位查詢</li>
            <li>即時座位顯示</li>
            <li>停車場資訊查詢</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="search-section">
      <div class="search-container">
        <label for="nameInput">姓名:</label>
        <input type="text" id="nameInput" placeholder="輸入姓名">
        <button id="submitBtn">標示位置</button>
      </div>
      <div id="image-container" style="position: relative; width: 439px; height: 332px;">
        <img src="./images/result_with_circles.jpg" alt="空白圖片" style="width: 439px; height: 332px;">
        <div id="marker" style="position: absolute; display: none; width: 40px; height: 40px; border: 2px solid yellow; background-color: transparent; border-radius: 50%; transform: translate(-50%, -50%); animation: blink 1s infinite;"></div>
      </div>
    </section>

    <section class="parking-info-section">
      <div class="parking-info-container">
        <h2>停車場資訊</h2>
        <div id="parking-image-container" style="position: relative; width: 439px; height: 332px;">
          <img src="./images/park.png" alt="停車場地圖" style="width: 439px; height: 332px;">
          <div class="parking-marker" style="position: absolute; left: 50px; top: 100px;">P1</div>
          <div class="parking-marker" style="position: absolute; left: 150px; top: 150px;">P2</div>
          <div class="parking-marker" style="position: absolute; left: 250px; top: 100px;">P3</div>
          <div class="parking-marker" style="position: absolute; left: 350px; top: 150px;">P4</div>
          <div class="parking-marker" style="position: absolute; left: 200px; top: 250px;">P5</div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2024 座標查詢系統</p>
  </footer>

  <script>
    let nameCoordinates = {};

    // 從 Flask API 讀取座標資料
    $.get('http://10.214.57.75:7860/get_coordinates', function(data) {
      nameCoordinates = data;
    }).fail(function(error) {
      console.error('讀取座標資料失敗:', error);
    });

    $(document).ready(function() {
      $('#submitBtn').click(function() {
        const inputValue = $('#nameInput').val().trim();
        const marker = $('#marker');
        
        // 將輸入值轉為數字並取餘數
        const number = parseInt(inputValue);
        if (!isNaN(number)) {
          const mappedNumber = ((number - 1) % 100 + 1).toString();
          
          if(nameCoordinates[mappedNumber]) {
            const coords = nameCoordinates[mappedNumber];
            marker.css({
              'left': `${coords.x}px`,
              'top': `${coords.y}px`,
              'display': 'block'
            });
            marker.attr('title', `${inputValue} -> ${mappedNumber} 的位置`);
          } else {
            alert('查無此編號的座標資料。');
            marker.hide();
          }
        } else {
          alert('請輸入有效的數字。');
          marker.hide();
        }
      });
    });

    // 新增滾動功能
    function scrollToSection(sectionClass) {
      const section = document.querySelector('.' + sectionClass);
      section.scrollIntoView({ behavior: 'smooth' });
    }
  </script>
</body>
</html>
